# 高效编辑技巧

## 核心理念

Vim 的强大在于 **组合**：

```
操作符 + 动作 = 编辑命令
```

| 操作符 | 含义 |
|--------|------|
| `d` | 删除 |
| `c` | 修改（删除并进入插入模式） |
| `y` | 复制 |
| `v` | 选择 |

| 动作 | 范围 |
|------|------|
| `w` | 单词 |
| `$` | 到行尾 |
| `}` | 到段落尾 |
| `iw` | 内部单词 |
| `i"` | 引号内 |
| `i{` | 大括号内 |

**组合示例**：

```vim
dw      " 删除单词
d$      " 删除到行尾
di"     " 删除引号内内容
ci{     " 修改大括号内内容
ya}     " 复制大括号及内容
```

---

## 文本对象（最重要）

### 内部 vs 包含

| 前缀 | 含义 | 例子 |
|------|------|------|
| `i` | inner（内部） | `di"` 删除引号内容，保留引号 |
| `a` | around（包含） | `da"` 删除引号及内容 |

### 常用文本对象

| 对象 | 说明 | 使用场景 |
|------|------|----------|
| `iw` / `aw` | 单词 | 重命名变量 |
| `i"` / `a"` | 双引号 | 修改字符串 |
| `i'` / `a'` | 单引号 | 修改字符串 |
| `i)` / `a)` | 小括号 | 修改参数 |
| `i]` / `a]` | 方括号 | 修改数组 |
| `i}` / `a}` | 大括号 | 修改代码块 |
| `it` / `at` | HTML 标签 | 修改标签内容 |
| `ip` / `ap` | 段落 | 操作整段代码 |

### 实战示例

```javascript
// 光标在 "hello" 的 e 上
const msg = "hello world";

ci"         // 修改引号内 → const msg = "|";
di"         // 删除引号内 → const msg = "";
da"         // 删除含引号 → const msg = ;
yi"         // 复制引号内 → 寄存器中是 hello world
```

```javascript
// 光标在函数参数中
function test(arg1, arg2) {

di)         // 删除括号内 → function test() {
ci)         // 修改括号内 → function test(|) {
```

```html
<!-- 光标在标签内 -->
<div>content here</div>

cit         // 修改标签内 → <div>|</div>
dat         // 删除整个标签 → (空)
```

---

## 快速选择

### 可视模式类型

| 快捷键 | 模式 | 用途 |
|--------|------|------|
| `v` | 字符可视 | 选择任意文本 |
| `V` | 行可视 | 选择整行 |
| `Ctrl+v` | 块可视 | 选择矩形区域 |

### 快速选中

```vim
" 选中单词
viw

" 选中引号内
vi"

" 选中括号内
vi)
vi}
vi]

" 选中整个函数体
vi{

" 选中段落
vip

" 全选
ggVG
```

---

## 多行编辑

### 块模式基础

```vim
" 1. 进入块可视模式
Ctrl+v

" 2. 选择区域
jjj         " 向下选择

" 3. 操作
I           " 在选区前插入
A           " 在选区后追加
d           " 删除选区
c           " 修改选区

" 4. 输入内容（只在第一行显示）
//

" 5. 按 Esc，应用到所有行
Esc
```

### 实战：多行注释

```vim
" 选中要注释的行
Ctrl+v
jjjj        " 选中 5 行

" 行首插入
I
//
Esc

" 结果：5 行都加上了 //
```

### 实战：多行行尾加分号

```vim
" 选中行
Ctrl+v
jjjj

" 到行尾
$

" 追加
A
;
Esc
```

### 实战：删除多行行首空格

```vim
Ctrl+v
jjjj
l           " 选择两个字符宽度
d           " 删除
```

---

## 快速替换

### 单词替换

```vim
" 光标在单词上
ciw         " 删除单词并进入插入模式
新单词
Esc
```

### 行内替换

```vim
" 替换到行尾
C           " = c$

" 替换整行
cc          " 或 S
```

### 全局替换

```vim
" 替换当前行
:s/old/new/g

" 替换全文
:%s/old/new/g

" 替换并确认
:%s/old/new/gc

" 替换指定范围（5-10行）
:5,10s/old/new/g

" 替换选中区域
" 先 V 选中，然后
:'<,'>s/old/new/g
```

### 智能替换技巧

```vim
" 只替换完整单词
:%s/\<old\>/new/g

" 保留大小写
:%s/old/new/gi

" 使用捕获组
:%s/\(.*\)_old/\1_new/g
```

---

## 复制粘贴进阶

### 寄存器

```vim
" 默认寄存器
yy          " 复制到默认寄存器
p           " 从默认寄存器粘贴

" 指定寄存器
"ayy        " 复制到寄存器 a
"ap         " 从寄存器 a 粘贴

" 系统剪贴板
"+y         " 复制到系统剪贴板
"+p         " 从系统剪贴板粘贴

" 查看所有寄存器
:registers
```

### 常用寄存器

| 寄存器 | 内容 |
|--------|------|
| `""` | 默认寄存器 |
| `"0` | 上次复制内容（不含删除） |
| `"+` | 系统剪贴板 |
| `"_` | 黑洞寄存器（删除不保存） |
| `"/` | 上次搜索内容 |

### 实战技巧

```vim
" 删除但不影响剪贴板
"_dd        " 删除行到黑洞

" 粘贴上次复制的内容（即使刚删除了东西）
"0p

" 复制到系统剪贴板后在其他应用粘贴
"+yy        " 复制行
" 然后在浏览器 Cmd+V 粘贴
```

---

## 撤销与重做

### 基础

```vim
u           " 撤销
Ctrl+r      " 重做
```

### 撤销到特定时间

```vim
:earlier 5m     " 回到 5 分钟前
:later 5m       " 前进 5 分钟
:earlier 10     " 撤销 10 次
```

### 撤销分支

Vim 保存完整的撤销树，可以恢复任何历史状态：

```vim
:undolist       " 查看撤销历史
g-              " 回到旧状态
g+              " 回到新状态
```

---

## 搜索与跳转

### 快速搜索

```vim
*           " 搜索光标下单词（向下）
#           " 搜索光标下单词（向上）
n           " 下一个匹配
N           " 上一个匹配
```

### 行内跳转

```vim
f{char}     " 跳到本行下一个 {char}
F{char}     " 跳到本行上一个 {char}
t{char}     " 跳到 {char} 前一个字符
T{char}     " 跳到 {char} 后一个字符
;           " 重复上次 f/F/t/T
,           " 反向重复
```

### 实战：快速到达引号

```vim
" 光标在行首
const msg = "hello";

f"          " 跳到第一个引号
;           " 跳到第二个引号
```

---

## 代码折叠

### 基础折叠

```vim
zc          " 折叠当前块
zo          " 展开当前块
za          " 切换折叠状态
zM          " 折叠所有
zR          " 展开所有
```

### 基于缩进折叠

```vim
:set foldmethod=indent
```

### 基于语法折叠

```vim
:set foldmethod=syntax
```

---

## 宏录制

### 基础流程

```vim
" 1. 开始录制到寄存器 q
qq

" 2. 执行操作
0           " 行首
f"          " 跳到引号
ci"         " 修改引号内
新内容
Esc
j           " 下一行

" 3. 停止录制
q

" 4. 执行宏
@q

" 5. 重复执行
@@          " 重复上次宏
10@q        " 执行 10 次
```

### 实战：批量添加引号

原始数据：
```
apple
banana
orange
```

目标：
```
"apple",
"banana",
"orange",
```

```vim
" 录制宏
qq
0I"Esc
A",Esc
j
q

" 执行两次（处理剩余行）
2@q
```

---

## 缩进操作

### 单行缩进

```vim
>>          " 增加缩进
<<          " 减少缩进
==          " 自动缩进
```

### 多行缩进

```vim
" 选中后
>           " 增加缩进
<           " 减少缩进
=           " 自动缩进

" 或指定范围
:5,10>      " 5-10 行增加缩进
```

### 全文自动缩进

```vim
gg=G
```

---

## 数字操作

### 数字增减

```vim
Ctrl+a      " 数字 +1
Ctrl+x      " 数字 -1
5Ctrl+a     " 数字 +5
```

### 实战：批量修改序号

```
item1
item2
item3
```

改为从 10 开始：

```vim
" 光标在 1 上
9Ctrl+a     " 变成 10
j
9Ctrl+a
j
9Ctrl+a
```

---

## 常用组合速查

### 删除类

```vim
dd          " 删除行
D           " 删除到行尾
dw          " 删除单词
diw         " 删除单词（不含空格）
daw         " 删除单词（含空格）
di"         " 删除引号内
da"         " 删除含引号
di{         " 删除大括号内
dip         " 删除段落
d/pattern   " 删除到匹配处
```

### 修改类

```vim
cc          " 修改整行
C           " 修改到行尾
cw          " 修改单词
ciw         " 修改单词
ci"         " 修改引号内
ci{         " 修改大括号内
cit         " 修改标签内
```

### 复制类

```vim
yy          " 复制行
Y           " 复制行
yw          " 复制单词
yiw         " 复制单词
yi"         " 复制引号内
yip         " 复制段落
```

---

## 一句话总结

**`ci{对象}` 修改 + `di{对象}` 删除 + `.` 重复 = 编辑效率翻倍**

记住文本对象（`iw`/`i"`/`i{`/`it`），配合操作符（`c`/`d`/`y`），你就掌握了 Vim 编辑的精髓。
