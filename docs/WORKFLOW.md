# 开发工作流指南

## 日常开发流程

### 启动工作

```bash
# 1. 进入项目目录
cd my-project

# 2. 启动 nvim
nvim

# 3. 恢复上次工作区
:SessionLoad
```

### 结束工作

```vim
" 保存工作区状态
:SessionSave

" 退出
:qa
```

---

## 典型开发场景

### 场景 1：修复一个 Bug

```vim
" 1. 搜索错误关键词
Space + fw
输入错误信息

" 2. 跳到相关代码
Enter

" 3. 查看函数定义
gd

" 4. 理解上下文
K           " 看文档
gr          " 看谁调用了这里

" 5. 修改代码
i           " 进入插入模式
...编辑...
Esc

" 6. 保存
:w

" 7. 返回之前位置
Ctrl+o
```

### 场景 2：添加新功能

```vim
" 1. 找到要修改的文件
Space + ff
输入文件名

" 2. 找到插入位置
/function    " 搜索
n            " 下一个匹配

" 3. 在下方新建行并插入
o

" 4. 写代码（有补全）
...编写...

" 5. 格式化
Esc
Space + lf

" 6. 保存
:w
```

### 场景 3：代码审查/阅读

```vim
" 1. 打开文件
Space + ff

" 2. 快速浏览结构
Space + ds    " 文档符号列表

" 3. 跳到感兴趣的函数
gd            " 跳转定义

" 4. 查看实现细节
K             " 悬浮文档

" 5. 查看调用关系
gr            " 查看引用

" 6. 返回
Ctrl+o
```

---

## 多文件编辑

### 同时编辑多个文件

```vim
" 打开第一个文件
:e src/main.ts

" 垂直分屏打开第二个
:vsp src/utils.ts

" 水平分屏打开第三个
:sp src/types.ts

" 在窗口间切换
Ctrl+w h/j/k/l
```

### 快速切换文件

```vim
" 方法 1：Buffer 列表（最快）
Space + fb

" 方法 2：最近文件
Space + fo

" 方法 3：上一个文件
Ctrl+^

" 方法 4：文件树
Space + e
```

### 比较两个文件

```vim
" 垂直分屏
:vsp 另一个文件

" 开启 diff 模式
:diffthis

" 在另一个窗口也执行
Ctrl+w l
:diffthis

" 关闭 diff
:diffoff!
```

---

## 快速定位

### 文件内定位

| 目标 | 快捷键 |
|------|--------|
| 第 N 行 | `{N}G` 或 `:{N}` |
| 文件开头 | `gg` |
| 文件末尾 | `G` |
| 函数定义 | `gd` |
| 搜索文本 | `/{pattern}` |
| 下一个匹配 | `n` |
| 上一个匹配 | `N` |

### 项目内定位

| 目标 | 快捷键 |
|------|--------|
| 按文件名 | `Space + ff` |
| 按内容 | `Space + fw` |
| 按符号 | `Space + ds` |
| 按引用 | `gr` |

### 历史定位

| 目标 | 快捷键 |
|------|--------|
| 上一个位置 | `Ctrl+o` |
| 下一个位置 | `Ctrl+i` |
| 上次编辑处 | `g;` |
| 最近文件 | `Space + fo` |

---

## 代码编写流程

### 1. 写代码

```vim
i           " 进入插入模式
            " 开始输入，会自动补全
Ctrl+n      " 选择下一个补全项
Ctrl+p      " 选择上一个补全项
Enter       " 确认补全
Tab         " 展开代码片段
```

### 2. 保存检查

```vim
Esc         " 退出插入模式
:w          " 保存

" 如果有错误，会在左侧显示标记
]d          " 跳到下一个错误
Space + ca  " 查看修复建议
```

### 3. 格式化

```vim
Space + lf  " 格式化当前文件
```

### 4. 提交代码

```vim
" 查看改动
:Gitsigns diffthis

" 暂存当前文件
:Gitsigns stage_buffer

" 提交（使用终端）
Space + h   " 打开终端
git commit -m "message"
```

---

## 调试技巧

### 快速打印调试

```vim
" 1. 光标放在变量上
" 2. 复制变量名
yiw

" 3. 下方新建行
o

" 4. 输入打印语句
console.log('变量名:', 变量名)

" 5. 粘贴变量名
Ctrl+r "    " 粘贴寄存器内容
```

### 快速注释

```vim
gcc         " 注释/取消注释当前行
gc{motion}  " 注释指定范围
gcap        " 注释整个段落

" 可视模式
V           " 选中多行
gc          " 注释选中行
```

### 临时测试代码

```vim
" 打开临时 Buffer
:enew

" 写测试代码
i
...测试代码...
Esc

" 不保存关闭
:q!
```

---

## 重构技巧

### 重命名变量

```vim
" 方法 1：LSP 重命名（推荐）
Space + ra
输入新名称
Enter

" 方法 2：全局替换
:%s/旧名称/新名称/gc
```

### 提取函数

```vim
" 1. 选中要提取的代码
V           " 可视行模式
选中代码块

" 2. 剪切
d

" 3. 跳到合适位置
gg / G / {N}G

" 4. 新建函数
o
function newFunc() {

" 5. 粘贴
p

" 6. 补全括号
o
}
```

### 移动代码块

```vim
" 选中代码块
V
jjj         " 选中多行

" 移动
:m '>+1     " 下移一行
:m '<-2     " 上移一行

" 或使用快捷键（如果配置了）
J / K       " 上下移动选中行
```

---

## 终端集成

### 打开终端

```vim
Space + h   " 水平终端
Space + v   " 垂直终端
```

### 终端操作

| 快捷键 | 功能 |
|--------|------|
| `Ctrl+\` `Ctrl+n` | 退出终端模式 |
| `i` | 重新进入终端模式 |
| `exit` | 关闭终端 |

### 常用终端命令

```bash
# 运行测试
npm test
pytest

# 启动开发服务器
npm run dev
python manage.py runserver

# Git 操作
git status
git add .
git commit -m "message"
git push
```

---

## 项目导航

### 使用文件树

```vim
Space + e   " 打开/关闭文件树

" 文件树内操作
Enter       " 打开文件
a           " 新建文件
d           " 删除
r           " 重命名
c           " 复制
p           " 粘贴
```

### 使用标记（Marks）

```vim
" 设置标记
ma          " 在当前位置设置标记 a

" 跳转到标记
'a          " 跳到标记 a 的行
`a          " 跳到标记 a 的精确位置

" 常用标记
''          " 跳回上次位置
'.          " 跳到最后编辑位置
```

---

## 效率提升

### 重复操作

```vim
.           " 重复上次操作

" 例子：给多行加分号
A;          " 行尾加分号
Esc
j           " 下一行
.           " 重复（加分号）
j.j.j.      " 继续重复
```

### 录制宏

```vim
" 开始录制到寄存器 q
qq

" 执行操作
...一系列操作...

" 停止录制
q

" 执行宏
@q

" 执行 10 次
10@q
```

### 批量编辑

```vim
" 多行行首插入
Ctrl+v      " 可视块模式
jjj         " 选中多行
I           " 插入模式
//          " 输入注释符
Esc         " 应用到所有行

" 多行行尾追加
Ctrl+v
jjj
$           " 到行尾
A           " 追加模式
;           " 输入分号
Esc         " 应用到所有行
```

---

## 常用快捷键速查

### 文件操作

```vim
:w          保存
:q          退出
:wq         保存退出
:e file     打开文件
Space+e     文件树
Space+ff    查找文件
Space+fo    最近文件
```

### 编辑操作

```vim
i/a         插入/追加
o/O         下方/上方新建行
dd          删除行
yy          复制行
p           粘贴
u           撤销
Ctrl+r      重做
gcc         注释
```

### 导航操作

```vim
gd          跳定义
gr          看引用
K           看文档
Ctrl+o/i    前进后退
Space+fb    切 Buffer
Space+fw    搜内容
```

### 窗口操作

```vim
Ctrl+w v    垂直分屏
Ctrl+w s    水平分屏
Ctrl+w q    关闭窗口
Ctrl+w =    均分窗口
Ctrl+w hjkl 切换窗口
```

---

## 一句话总结

**日常开发三板斧：`Space+ff` 找文件 → `gd` 看定义 → `Ctrl+o` 返回**

把这三个练成肌肉记忆，开发效率翻倍。
